---
title: "Simulate risk equalization data"
author: "Piet Stam"
date: "2023-06-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(1000)
options("digits" = 2)
library(truncnorm)  # For rtruncnorm()
```

## Create S and N variables

We initialize the parameters first. The source of these parameters is [my PhD thesis](https://api.zotero.org/users/24775/publications/items/KBKWIQDJ/file/view), unless stated otherwise.

```{r parameters}
nobs <- 10

population_means_m_age <- c(0.042,0.071,0.069,0.063,0.057,0.050,0.023,0.003)
population_means_f_age <- c(0.062,0.113,0.128,0.113,0.089,0.072,0.040,0.007)
population_means_incsrc <- c(0.090,0.595,0.041,0.042,0.205,0.028)
population_means_region <- c(0.072,0.206,0.095,0.092,0.146,0.099,0.167,0.028,0.033,0.061)
population_means_PCG <- c(0.912,0.034,0.005,0.002,0.028,0.003,0.001,0.012,0.001,0.0005,0.001,0.001,0.0005)
population_means_DCG <- c(0.972,0.004,0.005,0.004,0.004,0.003,0.001,0.002,0.002,0.0005,0.001,0.001,0.001,0.0005)

population_means_OECD <- c(0.796,0.103,0.049,0.052)
```

```{r rescaled_parameters}
fn_scale_probs <- function(x){x/sum(x)}

population_means_m_age <- fn_scale_probs(c(population_means_m_age, population_means_f_age))[1:length(population_means_m_age)]
population_means_f_age <- fn_scale_probs(c(population_means_m_age, population_means_f_age))[length(population_means_m_age)+1:length(population_means_f_age)]
population_means_incsrc <- fn_scale_probs(population_means_incsrc)
population_means_region <- fn_scale_probs(population_means_region)
population_means_PCG <- fn_scale_probs(population_means_PCG)
population_means_DCG <- fn_scale_probs(population_means_DCG)

population_means_OECD <- fn_scale_probs(population_means_OECD)
```

Then we create the S-variables: 8 age dummies for men, 8 age dummies for women, 6 sources of income, 10 regional dummies, 13 PCGs, 14 DCGs.

```{r svars}
m_age <- matrix(rmultinom(nobs, 1, prob = population_means_m_age), nrow = nobs, ncol = length(population_means_m_age), byrow = TRUE)
colnames(m_age) <- paste0("M_AGE", 1:(length(population_means_m_age)))

f_age <- matrix(rmultinom(nobs, 1, prob = population_means_f_age), nrow = nobs, ncol = length(population_means_f_age), byrow = TRUE)
colnames(f_age) <- paste0("F_AGE", 1:(length(population_means_f_age)))

incsrc <- matrix(rmultinom(nobs, 1, prob = population_means_incsrc), nrow = nobs, ncol = length(population_means_incsrc), byrow = TRUE)
colnames(incsrc) <- paste0("INCSRC", 1:(length(population_means_incsrc)))

region <- matrix(rmultinom(nobs, 1, prob = population_means_region), nrow = nobs, ncol = length(population_means_region), byrow = TRUE)
colnames(region) <- paste0("REGION", 1:(length(population_means_region)))

PCG <- matrix(rmultinom(nobs, 1, prob = population_means_PCG), nrow = nobs, ncol = length(population_means_PCG), byrow = TRUE)
colnames(PCG) <- paste0("PCG", 0:(length(population_means_PCG)-1))

DCG <- matrix(rmultinom(nobs, 1, prob = population_means_DCG), nrow = nobs, ncol = length(population_means_DCG), byrow = TRUE)
colnames(DCG) <- paste0("DCG", 0:(length(population_means_DCG)-1))
  
PF <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.80, sd = 0.24) # Source: Medical Care
RP <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.72, sd = 0.40) # Source: Medical Care
BP <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.73, sd = 0.25) # Source: Medical Care
GH <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.67, sd = 0.21) # Source: Medical Care
VT <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.64, sd = 0.20) # Source: Medical Care
SF <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.81, sd = 0.24) # Source: Medical Care
RE <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.79, sd = 0.36) # Source: Medical Care
MH <- rtruncnorm(nobs, a = 0, b = 1, mean = 0.74, sd = 0.19) # Source: Medical Care

OECD <- matrix(rmultinom(nobs, 1, prob = population_means_OECD), nrow = nobs, ncol = length(population_means_OECD), byrow = TRUE)
colnames(OECD) <- paste0("OECD", 0:(length(population_means_OECD)-1))

CCI <- rtruncnorm(nobs, a = 0, b = 0.79, mean = 0.04, sd = 0.07) # Source: Medical Care
```

And we create the N-variables.

```{r nvars}
hprice <- rnorm(nobs, mean = 5.94)
hdist <- rnorm(nobs, mean = 4.38)
gpdist <- rnorm(nobs, mean = 0.16)
```

Append all variables to one tibble.

```{r}
simul_data <- data.frame(m_age,f_age,incsrc,region,PCG,DCG,PF,RP,BP,GH,VT,SF,RE,MH,OECD,CCI,hprice,hdist,gpdist)
```

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
